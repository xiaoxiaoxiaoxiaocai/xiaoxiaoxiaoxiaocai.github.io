### 流量分析

- 总体把握
  - 协议分级
  - 端点统计
- 过滤赛选
  - 过滤语法
  - Host，Protocol，contains，特征值
- 发现异常
  - 特殊字符串
  - 协议某字段
  - flag 位于服务器中
- 数据提取
  - 字符串取
  - 文件提取

总的来说比赛中的流量分析可以概括为以下三个方向:

- 流量包修复
- 协议分析
- 数据提取

#### pcar文件修复

https://f00l.de/hacking/pcapfix.php（在线）

https://github.com/Rup0rt/pcapfix/tree/devel（下载）

##### 常见块：

Section Header Block（文件头）：

必须存在

Interface Description Block（接口描述）：

必须存在

Packet Block（数据块）:

#### wireshark

##### 显示过滤器

###### 配置方法

1.借助过滤器窗口

2.借助于工具栏的输入条

3.将数据包的某个属性指定为过滤条件

![image-20230525195412024](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20230525195412024.png)

##### 信息统计

###### Protocol History（协议分级）

![image-20230525195923361](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20230525195923361.png)

捕捉文件所包含的所有协议的树状分枝

| 名称          | 含义                                           |
| :------------ | :--------------------------------------------- |
| Protocol：    | 协议名称                                       |
| % Packets：   | 含有该协议的包数目在捕捉文件所有包所占的比例   |
| Packets：     | 含有该协议的包的数目                           |
| Bytes：       | 含有该协议的字节数                             |
| Mbit/s：      | 抓包时间内的协议带宽                           |
| End Packets： | 该协议中的包的数目（作为文件中的最高协议层）   |
| End Bytes：   | 该协议中的字节数（作为文件中的最高协议层）     |
| End Mbit/s：  | 抓包时间内的协议带宽（作为文件中的最高协议层） |

##### Conversation

发生于特定端点的IP间的所有流量。

 查看收发大量数据流的 IP 地址

##### EndPoints（端点）

列出了所有endpoints上的统计信息

##### HTTP

###### packet Counter（分组计数器）

每一个网站的报文数量，帮助识别响应和请求。

#### HTTP

HTTP（超文本传输协议）是一种用于分布式，协作式和超媒体信息系统的应用层协议。HTTP是万维网的数据通信基础。

#### HTTPS

HTTPS=HTTP+SSL/TLS. 服务端和客户端的信息传输都会通过TLS进行加密，所以传输的数据都是加密后的数据。

#### FTP

`FTP` ( `File Transfer Protocol` ，即文件传输协议) 是 `TCP/IP` 协议组中的协议之一。 `FTP` 协议包括两个组成部分，其一为 `FTP` 服务器，其二为 `FTP` 客户端。其中 `FTP` 服务器用来存储文件，用户可以使用 `FTP` 客户端通过 `FTP` 协议访问位于 `FTP` 服务器上的资源。在开发网站的时候，通常利用 `FTP` 协议把网页或程序传到 `Web` 服务器上。此外，由于 `FTP` 传输效率非常高，在网络上传输大的文件时，一般也采用该协议。

默认情况下 `FTP` 协议使用 `TCP` 端口中的 `20` 和 `21` 这两个端口，其中 `20` 用于传输数据， `21` 用于传输控制信息。但是，是否使用 `20` 作为传输数据的端口与 `FTP` 使用的传输模式有关，如果采用主动模式，那么数据传输端口就是 `20` ；如果采用被动模式，则具体最终使用哪个端口要服务器端和客户端协商决定。

#### DNS

DNS通常为UDP协议，

+-------------------------------+ | 报文头                         | +-------------------------------+ | 问题 (向服务器提出的查询部分)    | +-------------------------------+ | 回答 (服务器回复的资源记录)      | +-------------------------------+ | 授权 (权威的资源记录)           | +-------------------------------+ | 额外的 (额外的资源记录)         | +-------------------------------+

查询包只有头部和问题。`DNS` 收到查询包后，根据查询到的信息追加回答信息、授权机构、额外资源记录，并且修改了包头的相关标识再返回给客户端。

每个 `question` 部分

```
   0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
 |                                               |
 /                     QNAME                     /
 /                                               /
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
 |                     QTYPE                     |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
 |                     QCLASS                    |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- `QNAME` ：为查询的域名，是可变长的，编码格式为：将域名用. 号划分为多个部分，每个部分前面加上一个字节表示该部分的长度，最后加一个 `0` 字节表示结束
- `QTYPE` ：占 `16` 位，表示查询类型，共有 `16` 种，常用值有：`1` ( `A` 记录，请求主机 `IP` 地址)、`2` ( `NS` ，请求授权 `DNS` 服务器)、`5` ( `CNAME` 别名查询)

#### WIFI

IEEE 802.11是现今无线局域网通用的标准,常见认证方式有:不启用安全、WEP、WPA/WPA2-PSK、PA/WPA2 802.1X

> BSSID :路由器、AP的MAC地址 PWR:信号强度，- -看就是越小越强了 Data :传输的数据大小，大的可能在下载或看视频什么的 CH:无线信道，要看准 ENC :加密协议 ESSID:这个就不用多说了，wiff名称，有中文可能会出现乱码哈

对流量包爆破密码 aircrack-ng XXX.pcap -w /usr/share/wordlists/rockyou.txt 用密码解密流量包 airdecap-ng [capfile] -e [ESSID] -p [password]

#####  WPA-PSK

WPA/WPA2 口令(passphrase)： 由网络所有者选择和输入的8~63个ASCII字符的字符串。该口令是配置在接入点（AP, Access Point）的，从连接到APs无线网络的客户端设备通过手动输入。

请求者(Supplicant)： 任何企图接入APs服务集的设备。

PSK(Pre-Shared Key, 预共享密钥)： 口令(passphrase)经PSK映射转换算法处理后得到的结果。

PMK(Pairwise Master Key, 成对主密钥)： 密钥大师(master)哈哈，最高等级的密钥，由PSK生成。

GMK(Group Master Key, 组主密钥)： 由认证器（接入点）生成，是组临时密钥 (GTK)的种子。

4次握手： 使用伪随机函数来创建和分发动态加密密钥的过程。

Nonce： 一个随机生成的值，只使用一次。

PTK(Pairwise Transient Key, 成对临时密钥)： 最终用于加密单播数据流的加密密钥。

GTK (Group Temporal Key, 组临时密钥)：最终用于加密广播和组播数据流的加密密钥。


1. 4 次握手开始于验证器 (AP)，它产生一个随机的值(ANonce) 发送给请求者
2. 请求者也产生了它自己的随机 SNonce，然后用这两个 Nonces 以及 PMK 生成了 PTK。请求者回复消息 2 给验证器, 还有一个 MIC（message integrity code，消息验证码）作为 PMK 的验证
3. 它先要验证请求者在消息 2 中发来的 MIC 等信息，验证成功后，如果需要就生成 GTK。然后发送消息 3
4. 请求者收到消息 3，验证 MIC，安装密钥，发送消息 4，一个确认信息。验证器收到消息 4，验证 MIC，安装相同的密钥

WIFI连接认证的重点在WPA的四次握手包，也就是eapol协议的包

##### usb

```
 usb协议
 USB UART
 USB HID
 USB Memory
```